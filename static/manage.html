<!DOCTYPE html>
<html lang="zh-CN" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理控制台 - Sora2API</title>
    <script>
        window.tailwind = window.tailwind || { config: () => { } };
    </script>
    <script src="/static/js/tailwind-cdn.js?v=20251211c"></script>
    <style>
        @keyframes slide-up {
            from {
                transform: translateY(100%);
                opacity: 0
            }

            to {
                transform: translateY(0);
                opacity: 1
            }
        }

        .animate-slide-up {
            animation: slide-up .3s ease-out
        }

        .tab-btn {
            transition: all .2s ease
        }

        /* ... (Keep existing CSS styles) ... */
        @keyframes quota-glow {
            0% {
                background: rgba(var(--qa, 34, 197, 94), 0.08);
                box-shadow: inset 0 0 0 1px rgba(var(--qa, 34, 197, 94), 0.16), 0 0 0 rgba(var(--qa, 34, 197, 94), 0)
            }

            35% {
                background: rgba(var(--qa, 34, 197, 94), 0.16);
                box-shadow: inset 0 0 0 1px rgba(var(--qa, 34, 197, 94), 0.34), 0 14px 36px rgba(var(--qa, 34, 197, 94), 0.16)
            }

            100% {
                background: rgba(var(--qa, 34, 197, 94), 0);
                box-shadow: inset 0 0 0 0 rgba(var(--qa, 34, 197, 94), 0), 0 0 0 rgba(var(--qa, 34, 197, 94), 0)
            }
        }

        @keyframes quota-mist {
            0% {
                opacity: 0;
                transform: scale(1)
            }

            25% {
                opacity: .9;
                transform: scale(1.01)
            }

            100% {
                opacity: 0;
                transform: scale(1.04)
            }
        }

        @keyframes quota-sweep {
            0% {
                transform: translateX(-160%) skewX(-18deg);
                opacity: 0
            }

            10% {
                opacity: 1
            }

            26% {
                transform: translateX(240%) skewX(-18deg);
                opacity: 0
            }

            54% {
                transform: translateX(-160%) skewX(-18deg);
                opacity: 0
            }

            62% {
                opacity: 1
            }

            78% {
                transform: translateX(240%) skewX(-18deg);
                opacity: 0
            }

            100% {
                transform: translateX(240%) skewX(-18deg);
                opacity: 0
            }
        }

        @keyframes quota-pop {
            0% {
                transform: scale(1)
            }

            45% {
                transform: scale(1.08)
            }

            100% {
                transform: scale(1)
            }
        }

        @keyframes quota-text {
            0% {
                color: rgba(var(--qaText, 22, 163, 74), 0.98);
                text-shadow: 0 0 14px rgba(var(--qa, 34, 197, 94), 0.28)
            }

            55% {
                color: rgba(var(--qaText, 22, 163, 74), 0.92);
                text-shadow: 0 0 18px rgba(var(--qa, 34, 197, 94), 0.22)
            }

            100% {
                color: inherit;
                text-shadow: none
            }
        }

        @keyframes quota-delta-rise {
            0% {
                opacity: 0;
                transform: translateY(8px) scale(0.92);
                filter: blur(1px)
            }

            16% {
                opacity: 1;
                transform: translateY(0) scale(1.0);
                filter: blur(0)
            }

            70% {
                opacity: 1;
                transform: translateY(-6px) scale(1.02)
            }

            100% {
                opacity: 0;
                transform: translateY(-12px) scale(1.05);
                filter: blur(0)
            }
        }

        .quota-cell {
            position: relative
        }

        .quota-delta {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 12px;
            line-height: 1;
            font-weight: 900;
            letter-spacing: .2px;
            pointer-events: none;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            animation: quota-delta-rise 5.2s ease-out both;
            box-shadow: 0 10px 28px rgba(15, 23, 42, 0.10);
        }

        .quota-delta.up {
            color: #16a34a;
            border: 1px solid rgba(34, 197, 94, 0.28);
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.14), rgba(255, 255, 255, 0.06));
        }

        .quota-delta.down {
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.26);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.12), rgba(255, 255, 255, 0.05));
        }

        .quota-flash {
            --qa: 34, 197, 94;
            --qaText: 22, 163, 74;
            position: relative;
            overflow: hidden;
            border-radius: 10px;
            animation: quota-glow 5.2s ease-out;
        }

        .quota-flash.quota-down {
            --qa: 239, 68, 68;
            --qaText: 239, 68, 68;
        }

        .quota-flash.quota-neutral {
            --qa: 59, 130, 246;
            --qaText: 37, 99, 235;
        }

        .quota-flash::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: radial-gradient(circle at 22% 22%, rgba(255, 255, 255, 0.28), transparent 55%), radial-gradient(circle at 70% 85%, rgba(var(--qa, 34, 197, 94), 0.20), transparent 60%);
            opacity: 0;
            animation: quota-mist 5.2s ease-out;
        }

        .quota-flash::after {
            content: "";
            position: absolute;
            top: -30%;
            bottom: -30%;
            left: -75%;
            width: 58%;
            pointer-events: none;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.42), transparent);
            transform: translateX(-160%) skewX(-18deg);
            opacity: 0;
            animation: quota-sweep 5.2s ease-out;
        }

        .quota-flash span {
            position: relative;
            z-index: 1;
            animation: quota-pop .75s ease-out, quota-text 5.2s ease-out;
            transform-origin: left center;
        }

        @keyframes quota-spark {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) translate(var(--x0, 0px), var(--y0, 0px)) scale(0.66);
                filter: blur(0.45px)
            }

            16% {
                opacity: 1;
                transform: translate(-50%, -50%) translate(var(--x0, 0px), var(--y0, 0px)) scale(0.86);
                filter: blur(0.10px)
            }

            70% {
                opacity: .92
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) translate(var(--x1, 0px), var(--y1, 0px)) scale(1.18);
                filter: blur(0)
            }
        }

        .quota-spark {
            position: absolute;
            left: 50%;
            top: 50%;
            width: var(--s, 8px);
            height: var(--s, 8px);
            border-radius: 999px;
            pointer-events: none;
            opacity: 0;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.96), rgba(34, 197, 94, 0.46), transparent 72%);
            box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.10), 0 14px 36px rgba(34, 197, 94, 0.14);
            mix-blend-mode: screen;
            animation: quota-spark 5.2s ease-out both;
            animation-delay: var(--d, 0s);
        }

        .quota-spark.down {
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.94), rgba(239, 68, 68, 0.44), transparent 72%);
            box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.10), 0 14px 36px rgba(239, 68, 68, 0.14);
        }

        @keyframes quota-total-flash {
            0% {
                transform: translateY(0) scale(1);
                filter: saturate(1);
                text-shadow: 0 0 0 rgba(245, 158, 11, 0)
            }

            22% {
                transform: translateY(-1px) scale(1.06);
                filter: saturate(1.10);
                text-shadow: 0 0 18px rgba(245, 158, 11, 0.22)
            }

            58% {
                transform: translateY(0) scale(1.02);
                filter: saturate(1.06);
                text-shadow: 0 0 14px rgba(245, 158, 11, 0.16)
            }

            100% {
                transform: translateY(0) scale(1);
                filter: saturate(1);
                text-shadow: 0 0 0 rgba(245, 158, 11, 0)
            }
        }

        #statQuota.quota-total-flash {
            animation: quota-total-flash 2.4s ease-out
        }

        @media (prefers-reduced-motion: reduce) {
            .quota-flash {
                animation: none
            }

            .quota-flash::before {
                animation: none
            }

            .quota-flash::after {
                animation: none
            }

            .quota-flash span {
                animation: none
            }

            .quota-spark {
                display: none
            }

            #statQuota.quota-total-flash {
                animation: none
            }
        }

        @keyframes quota-loading-shimmer {
            0% {
                transform: translateX(-140%) skewX(-16deg);
                opacity: 0
            }

            20% {
                opacity: .95
            }

            100% {
                transform: translateX(240%) skewX(-16deg);
                opacity: 0
            }
        }

        @keyframes quota-loading-breath {
            0% {
                transform: translateY(-50%) scale(1);
                filter: saturate(1)
            }

            50% {
                transform: translateY(-50%) scale(1.02);
                filter: saturate(1.06)
            }

            100% {
                transform: translateY(-50%) scale(1);
                filter: saturate(1)
            }
        }

        @keyframes quota-loading-dots {

            0%,
            100% {
                background: rgba(15, 23, 42, 0.22);
                box-shadow: 10px 0 0 rgba(15, 23, 42, 0.22), 20px 0 0 rgba(15, 23, 42, 0.22)
            }

            25% {
                background: rgba(15, 23, 42, 0.60);
                box-shadow: 10px 0 0 rgba(15, 23, 42, 0.22), 20px 0 0 rgba(15, 23, 42, 0.22)
            }

            50% {
                background: rgba(15, 23, 42, 0.22);
                box-shadow: 10px 0 0 rgba(15, 23, 42, 0.60), 20px 0 0 rgba(15, 23, 42, 0.22)
            }

            75% {
                background: rgba(15, 23, 42, 0.22);
                box-shadow: 10px 0 0 rgba(15, 23, 42, 0.22), 20px 0 0 rgba(15, 23, 42, 0.60)
            }
        }

        .quota-cell[data-testing="1"] {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.08), rgba(255, 255, 255, 0));
            box-shadow: inset 0 0 0 1px rgba(59, 130, 246, 0.14);
            border-radius: 10px;
        }

        .quota-cell[data-testing="1"]>span {
            opacity: 0.62;
        }

        .quota-loading {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 3px 10px;
            border-radius: 999px;
            font-size: 12px;
            line-height: 1;
            font-weight: 900;
            letter-spacing: .2px;
            color: rgba(15, 23, 42, 0.82);
            border: 1px solid rgba(148, 163, 184, 0.36);
            background: radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.62), rgba(255, 255, 255, 0.10)), linear-gradient(135deg, rgba(255, 255, 255, 0.52), rgba(255, 255, 255, 0.18));
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 14px 34px rgba(15, 23, 42, 0.10);
            overflow: hidden;
            pointer-events: none;
            animation: quota-loading-breath 1.65s ease-in-out infinite;
        }

        .quota-loading::after {
            content: "";
            position: absolute;
            inset: -1px;
            pointer-events: none;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.58), transparent);
            transform: translateX(-140%) skewX(-16deg);
            animation: quota-loading-shimmer 1.25s linear infinite;
        }

        .quota-loading-pill {
            position: relative;
            z-index: 1
        }

        .quota-loading-dots {
            position: relative;
            z-index: 1;
            width: 6px;
            height: 6px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.22);
            box-shadow: 10px 0 0 rgba(15, 23, 42, 0.22), 20px 0 0 rgba(15, 23, 42, 0.22);
            animation: quota-loading-dots 1.05s ease-in-out infinite;
        }

        @keyframes row-pulse-ok {
            0% {
                background: rgba(34, 197, 94, 0.10)
            }

            45% {
                background: rgba(34, 197, 94, 0.14)
            }

            100% {
                background: rgba(34, 197, 94, 0)
            }
        }

        @keyframes row-pulse-fail {
            0% {
                background: rgba(239, 68, 68, 0.10)
            }

            45% {
                background: rgba(239, 68, 68, 0.14)
            }

            100% {
                background: rgba(239, 68, 68, 0)
            }
        }

        tr[data-pulse="ok"] td {
            animation: row-pulse-ok 1.25s ease-out
        }

        tr[data-pulse="fail"] td {
            animation: row-pulse-fail 1.25s ease-out
        }

        @media (prefers-reduced-motion: reduce) {
            .quota-loading {
                animation: none
            }

            .quota-loading::after {
                animation: none
            }

            .quota-loading-dots {
                animation: none
            }

            tr[data-pulse="ok"] td {
                animation: none
            }

            tr[data-pulse="fail"] td {
                animation: none
            }
        }

        @keyframes btn-shimmer {
            0% {
                transform: translateX(-140%) skewX(-18deg);
                opacity: 0
            }

            20% {
                opacity: .9
            }

            100% {
                transform: translateX(240%) skewX(-18deg);
                opacity: 0
            }
        }

        @keyframes btn-spin {
            from {
                transform: rotate(0deg)
            }

            to {
                transform: rotate(360deg)
            }
        }

        #btnTestAll {
            position: relative;
            overflow: hidden
        }

        #btnTestAll[data-loading="1"] {
            filter: saturate(1.06);
            box-shadow: 0 16px 38px rgba(245, 158, 11, 0.28);
        }

        #btnTestAll[data-loading="1"]::after {
            content: "";
            position: absolute;
            inset: -1px;
            pointer-events: none;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.40), transparent);
            transform: translateX(-140%) skewX(-18deg);
            animation: btn-shimmer 1.25s linear infinite;
        }

        #btnTestAll[data-loading="1"] svg {
            transform-origin: center;
            animation: btn-spin 1.15s linear infinite;
        }

        @keyframes btn-done {
            0% {
                transform: scale(1)
            }

            50% {
                transform: scale(1.03)
            }

            100% {
                transform: scale(1)
            }
        }

        #btnTestAll[data-done] {
            animation: btn-done .85s ease-out
        }

        #btnTestAll[data-done="ok"] {
            box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.40), 0 18px 42px rgba(34, 197, 94, 0.18)
        }

        #btnTestAll[data-done="warn"] {
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.34), 0 18px 42px rgba(239, 68, 68, 0.16)
        }

        .full-bleed-panel {
            width: 100vw;
            margin-left: calc(50% - 50vw);
            margin-right: calc(50% - 50vw);
            padding-left: 0;
            padding-right: 0;
        }

        .task-bubble {
            position: fixed;
            bottom: 18px;
            right: 18px;
            width: 64px;
            height: 64px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.42), rgba(255, 255, 255, 0.10)), linear-gradient(135deg, #2563eb, #4f46e5);
            color: #fff;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-weight: 800;
            letter-spacing: 0.2px;
            cursor: pointer;
            z-index: 1000;
            transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
            box-shadow: 0 14px 34px rgba(37, 99, 235, 0.35), inset 0 0 0 1px rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .task-bubble::before {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            pointer-events: none;
            background-image: radial-gradient(rgba(15, 23, 42, 0.22) 1px, transparent 1px);
            background-size: 7px 7px;
            opacity: 0.10;
            mix-blend-mode: overlay;
        }

        .task-bubble::after {
            content: "";
            position: absolute;
            inset: 2px;
            border-radius: inherit;
            pointer-events: none;
            background: radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.35), transparent 45%);
            opacity: 0.85;
        }

        .task-bubble:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 18px 40px rgba(37, 99, 235, 0.45);
            filter: saturate(1.05);
        }

        .task-bubble:active {
            transform: translateY(0) scale(0.97);
        }

        .task-bubble.hidden {
            display: none;
        }

        @keyframes pulse-ring {
            0% {
                box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.32);
            }

            70% {
                box-shadow: 0 0 0 14px rgba(79, 70, 229, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(79, 70, 229, 0);
            }
        }

        .task-bubble[data-running="1"] {
            animation: pulse-ring 1.8s ease-out infinite;
        }

        @keyframes bubble-pop {
            0% {
                transform: scale(1);
            }

            35% {
                transform: scale(1.07);
            }

            100% {
                transform: scale(1);
            }
        }

        .task-bubble.flash {
            animation: bubble-pop 0.55s ease;
        }

        .task-bubble-count {
            font-size: 18px;
            line-height: 1;
            position: relative;
            z-index: 1;
        }

        .task-bubble-icon {
            width: 18px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.16);
            border-radius: 6px;
            font-size: 12px;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.18);
            position: relative;
            z-index: 1;
        }

        .task-bubble-badge {
            position: absolute;
            top: -6px;
            left: -6px;
            min-width: 22px;
            height: 22px;
            padding: 0 6px;
            border-radius: 999px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: #fff;
            font-weight: 900;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 12px 22px rgba(239, 68, 68, 0.25), inset 0 0 0 1px rgba(255, 255, 255, 0.25);
            z-index: 2;
        }

        .task-drawer {
            transition: opacity .18s ease;
        }

        .task-drawer .task-drawer-backdrop {
            opacity: 0;
            transition: opacity .18s ease;
        }

        .task-drawer .task-drawer-panel {
            transform: translateX(14px);
            opacity: 0;
            transition: transform .22s ease, opacity .22s ease;
        }

        .task-drawer.open .task-drawer-backdrop {
            opacity: 1;
        }

        .task-drawer.open .task-drawer-panel {
            transform: translateX(0);
            opacity: 1;
        }

        .cc-surface {
            position: relative;
            overflow: hidden;
            border-radius: 18px;
            background: radial-gradient(900px 520px at 8% 10%, rgba(37, 99, 235, 0.18), transparent 58%), radial-gradient(760px 460px at 92% 18%, rgba(79, 70, 229, 0.16), transparent 56%), radial-gradient(760px 520px at 42% 92%, rgba(16, 185, 129, 0.12), transparent 58%), linear-gradient(180deg, rgba(255, 255, 255, 0.92), rgba(248, 250, 252, 0.88));
            box-shadow: 0 20px 52px rgba(15, 23, 42, 0.08);
        }

        .cc-surface::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background-image: radial-gradient(rgba(15, 23, 42, 0.14) 1px, transparent 1px);
            background-size: 6px 6px;
            opacity: 0.08;
            mix-blend-mode: overlay;
        }

        .cc-surface::after {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: radial-gradient(circle at 50% 0%, rgba(255, 255, 255, 0.55), transparent 55%);
        }

        @keyframes cc-enter {
            from {
                transform: translateY(8px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .cc-enter {
            animation: cc-enter 420ms cubic-bezier(.2, .8, .2, 1) both;
            animation-delay: calc(var(--i, 0) * 28ms);
        }

        .cc-btn {
            transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
        }

        .cc-btn:active {
            transform: scale(0.97);
        }

        .cc-focus:focus-visible {
            outline: 3px solid rgba(37, 99, 235, 0.45);
            outline-offset: 2px;
        }

        @media (prefers-reduced-motion: reduce) {
            .cc-enter {
                animation: none !important;
            }

            .cc-btn {
                transition: none !important;
            }
        }
    </style>
    <script>
        tailwind.config = { theme: { extend: { colors: { border: "hsl(0 0% 89%)", input: "hsl(0 0% 89%)", ring: "hsl(0 0% 3.9%)", background: "hsl(0 0% 100%)", foreground: "hsl(0 0% 3.9%)", primary: { DEFAULT: "hsl(0 0% 9%)", foreground: "hsl(0 0% 98%)" }, secondary: { DEFAULT: "hsl(0 0% 96.1%)", foreground: "hsl(0 0% 9%)" }, muted: { DEFAULT: "hsl(0 0% 96.1%)", foreground: "hsl(0 0% 45.1%)" }, destructive: { DEFAULT: "hsl(0 84.2% 60.2%)", foreground: "hsl(0 0% 98%)" } } } } }
    </script>
</head>

<body class="h-full bg-background text-foreground antialiased">
    <div id="globalTaskBubble" class="task-bubble hidden" title="生成任务进行中" aria-live="polite" aria-label="生成任务气泡"
        role="button" tabindex="0" aria-haspopup="dialog" aria-expanded="false">
        <span class="task-bubble-icon" aria-hidden="true">▶</span>
        <span id="globalTaskBubbleCount" class="task-bubble-count">0</span>
        <span id="globalTaskBubbleError" class="task-bubble-badge hidden" aria-label="错误任务数量">0</span>
    </div>
    <div id="taskDrawer" class="task-drawer hidden fixed inset-0 bg-black/30 z-50" aria-hidden="true">
        <div class="task-drawer-backdrop absolute inset-0" id="taskDrawerClose" data-close="1"></div>
        <div
            class="task-drawer-panel absolute right-0 top-0 h-full w-full max-w-md bg-white/85 backdrop-blur-xl shadow-2xl border-l border-slate-200/70 overflow-hidden">
            <div class="p-4 border-b border-slate-200/70 bg-white/70 backdrop-blur-xl sticky top-0 z-10">
                <div class="flex items-start justify-between gap-3">
                    <div class="min-w-0">
                        <h3 class="text-lg font-semibold leading-tight">任务中心</h3>
                        <div id="taskDrawerSummary" class="text-xs text-slate-500 mt-1">等待来自生成面板的任务状态…</div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="taskDrawerGoGenerate"
                            class="inline-flex items-center justify-center rounded-md border border-slate-200 bg-white hover:bg-slate-50 h-8 px-3 text-xs">打开生成面板</button>
                        <button id="taskDrawerCloseBtn"
                            class="inline-flex items-center justify-center rounded-md border border-slate-200 bg-white hover:bg-slate-50 h-8 px-3 text-xs">关闭</button>
                    </div>
                </div>
                <div class="mt-3 flex items-center gap-2 flex-wrap">
                    <input id="taskDrawerSearch"
                        class="flex h-9 w-full rounded-md border border-slate-200 bg-white/80 px-3 py-2 text-sm"
                        placeholder="搜索提示词 / 文件名…" />
                    <div class="flex items-center gap-2 flex-wrap w-full">
                        <button
                            class="task-filter-pill inline-flex items-center justify-center rounded-full border border-slate-200 bg-white/80 hover:bg-slate-50 h-8 px-3 text-xs"
                            data-filter="all">全部</button>
                        <button
                            class="task-filter-pill inline-flex items-center justify-center rounded-full border border-slate-200 bg-white/80 hover:bg-slate-50 h-8 px-3 text-xs"
                            data-filter="running">运行中</button>
                        <button
                            class="task-filter-pill inline-flex items-center justify-center rounded-full border border-slate-200 bg-white/80 hover:bg-slate-50 h-8 px-3 text-xs"
                            data-filter="error">错误</button>
                        <button
                            class="task-filter-pill inline-flex items-center justify-center rounded-full border border-slate-200 bg-white/80 hover:bg-slate-50 h-8 px-3 text-xs"
                            data-filter="done">已完成</button>
                    </div>
                </div>
            </div>
            <div class="p-4 overflow-y-auto" style="max-height: calc(100vh - 170px);">
                <div id="taskDrawerList" class="space-y-2 text-sm text-slate-800"></div>
            </div>
        </div>
    </div>
    <!-- 导航栏 -->
    <header class="sticky top-0 z-50 w-full border-b border-border/40 bg-background/95 backdrop-blur">
        <div class="mx-auto flex h-14 max-w-7xl items-center px-6">
            <div class="mr-4 flex items-baseline gap-3">
                <span class="font-bold text-xl">Sora2API</span>
            </div>
            <div class="flex flex-1 items-center justify-end gap-3">
                <a href="https://github.com/TheSmallHanCat/sora2api" target="_blank"
                    class="inline-flex items-center justify-center text-xs transition-colors hover:bg-accent hover:text-accent-foreground h-7 px-2.5"
                    title="GitHub 仓库">
                    <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v 3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                    </svg>
                </a>
                <button onclick="logout()"
                    class="inline-flex items-center justify-center text-xs transition-colors hover:bg-accent hover:text-accent-foreground h-7 px-2.5 gap-1">
                    <svg class="h-3.5 w-3.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" y1="12" x2="9" y2="12" />
                    </svg>
                    退出
                </button>
            </div>
        </div>
    </header>

    <main id="mainContainer" class="mx-auto max-w-7xl px-6 py-6" style="max-width: 1440px;">
        <div class="border-b border-border mb-6">
            <nav class="flex space-x-8">
                <button onclick="switchTab('tokens')" id="tabTokens"
                    class="tab-btn border-b-2 border-primary text-sm font-medium py-3 px-1">Token 管理</button>
                <button onclick="switchTab('settings')" id="tabSettings"
                    class="tab-btn border-b-2 border-transparent text-sm font-medium py-3 px-1">系统配置</button>
                <button onclick="switchTab('logs')" id="tabLogs"
                    class="tab-btn border-b-2 border-transparent text-sm font-medium py-3 px-1">请求日志</button>
                <button onclick="switchTab('videos')" id="tabVideos"
                    class="tab-btn border-b-2 border-transparent text-sm font-medium py-3 px-1">视频同步</button>
                <button onclick="switchTab('generate')" id="tabGenerate"
                    class="tab-btn border-b-2 border-transparent text-sm font-medium py-3 px-1">生成面板</button>
                <button onclick="switchTab('characters')" id="tabCharacters"
                    class="tab-btn border-b-2 border-transparent text-sm font-medium py-3 px-1">角色卡</button>
            </nav>
        </div>

        <!-- Token 管理面板 -->
        <div id="panelTokens">
            <div class="grid gap-4 grid-cols-2 md:grid-cols-5 lg:grid-cols-6 mb-6">
                <div class="rounded-lg border border-border bg-background p-4">
                    <p class="text-sm font-medium text-muted-foreground mb-2">Token 总数</p>
                    <h3 class="text-xl font-bold" id="statTotal">-</h3>
                </div>
                <div class="rounded-lg border border-border bg-background p-4">
                    <p class="text-sm font-medium text-muted-foreground mb-2">活跃 Token</p>
                    <h3 class="text-xl font-bold text-green-600" id="statActive">-</h3>
                </div>
                <div class="rounded-lg border border-border bg-background p-4">
                    <p class="text-sm font-medium text-muted-foreground mb-2">今日图片/总图片</p>
                    <h3 class="text-xl font-bold text-blue-600" id="statImages">-</h3>
                </div>
                <div class="rounded-lg border border-border bg-background p-4">
                    <p class="text-sm font-medium text-muted-foreground mb-2">今日视频/总视频</p>
                    <h3 class="text-xl font-bold text-purple-600" id="statVideos">-</h3>
                </div>
                <div class="rounded-lg border border-border bg-background p-4">
                    <p class="text-sm font-medium text-muted-foreground mb-2">今日错误/总错误</p>
                    <h3 class="text-xl font-bold text-destructive" id="statErrors">-</h3>
                </div>
                <div class="rounded-lg border border-border bg-background p-4">
                    <p class="text-sm font-medium text-muted-foreground mb-2">今日剩余/总次数</p>
                    <h3 class="text-xl font-bold text-amber-600" id="statQuota">-</h3>
                </div>
            </div>
            <div class="rounded-lg border border-border bg-background">
                <div class="flex items-center justify-between gap-4 p-4 border-b border-border">
                    <h3 class="text-lg font-semibold">Token 列表</h3>
                    <div class="flex items-center gap-3">
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-muted-foreground">自动刷新AT</span>
                            <div class="relative inline-flex items-center group">
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="atAutoRefreshToggle" onchange="toggleATAutoRefresh()"
                                        class="sr-only peer">
                                    <div
                                        class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary">
                                    </div>
                                </label>
                                <!-- 悬浮提示 -->
                                <div
                                    class="absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white text-xs rounded px-3 py-2 max-w-[360px] text-left leading-snug opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10">
                                    <div class="font-medium">自动刷新（AT）</div>
                                    <div class="opacity-90 mt-1">触发：AT 剩余 ≤ 24 小时（基于本表“过期时间(AT)”判断）。</div>
                                    <div class="opacity-90">方式：使用 ST / RT 尝试换取新的 Access Token（AT）。</div>
                                    <div class="opacity-80 mt-1">说明：本表“过期时间(AT)”显示的是 AT 的 JWT exp（本机时间）。ST 接口返回的 expires
                                        是会话到期时间 ≠ AT exp；因此刷新成功但此列不变属于正常情况（服务端未下发新 AT）。</div>
                                    <div
                                        class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button id="btnManualATRefresh" onclick="manualATAutoRefresh()"
                            class="inline-flex items-center justify-center rounded-md bg-amber-500 text-white hover:bg-amber-600 h-8 px-3 text-xs font-semibold shadow-sm"
                            title="手动触发：使用 ST/RT 尝试换取新的 AT。此表“过期时间(AT)”为 AT 的 JWT exp（本机时间）；若服务端未下发新 AT（exp 未变化），此列不会变化（正常）。">
                            手动刷新
                        </button>
                        <button onclick="refreshTokens()"
                            class="inline-flex items-center justify-center rounded-md transition-colors hover:bg-accent h-8 w-8"
                            title="刷新">
                            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10" />
                                <polyline points="1 20 1 14 7 14" />
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
                            </svg>
                        </button>
                        <button onclick="exportTokens()"
                            class="inline-flex items-center justify-center rounded-md bg-blue-600 text-white hover:bg-blue-700 h-8 px-3"
                            title="导出所有Token">
                            <svg class="h-4 w-4 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                <polyline points="7 10 12 15 17 10" />
                                <line x1="12" y1="15" x2="12" y2="3" />
                            </svg>
                            <span class="text-sm font-medium">导出</span>
                        </button>
                        <button onclick="openImportModal()"
                            class="inline-flex items-center justify-center rounded-md bg-green-600 text-white hover:bg-green-700 h-8 px-3"
                            title="导入Token">
                            <svg class="h-4 w-4 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                <polyline points="17 8 12 3 7 8" />
                                <line x1="12" y1="3" x2="12" y2="15" />
                            </svg>
                            <span class="text-sm font-medium">导入</span>
                        </button>
                        <button id="btnTestAll" onclick="testAllTokens()"
                            class="inline-flex items-center justify-center rounded-md bg-amber-500 text-white hover:bg-amber-600 h-8 px-3"
                            title="批量测试所有账号">
                            <svg class="h-4 w-4 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <path d="M5 13l4 4L19 7" />
                                <path d="M3 5h18" />
                            </svg>
                            <span class="text-sm font-medium">一键测试</span>
                        </button>
                        <button onclick="openAddModal()"
                            class="inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-8 px-3"><span
                                class="text-sm font-medium">新增</span></button>
                    </div>
                </div>
                <div class="relative w-full overflow-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-border">
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">邮箱</th>
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">状态</th>
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">Client ID
                                </th>
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground"
                                    title="此列显示 Access Token(AT) 的 JWT exp（本机时间）。ST 的 session expires 可能更长，且不会体现在此列。">
                                    过期时间(AT)</th>
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">账户类型</th>
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">Sora2
                                </th>
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">可用次数</th>
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">图片</th>
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">视频</th>
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">错误</th>
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">备注</th>
                                <th class="h-10 px-3 text-right align-middle font-medium text-muted-foreground">操作</th>
                            </tr>
                        </thead>
                        <tbody id="tokenTableBody" class="divide-y divide-border">
                            <!-- 动态填充 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 系统配置面板 -->
        <div id="panelSettings" class="hidden">
            <div class="grid gap-6 lg:grid-cols-2">
                <!-- 安全配置 -->
                <div class="rounded-lg border border-border bg-background p-6">
                    <h3 class="text-lg font-semibold mb-4">安全配置</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-sm font-medium mb-2 block">管理员用户名</label>
                            <input id="cfgAdminUsername" type="text"
                                class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm">
                            <p class="text-xs text-muted-foreground mt-1">管理员用户名</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium mb-2 block">旧密码</label>
                            <input id="cfgOldPassword" type="password"
                                class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                                placeholder="输入旧密码">
                        </div>
                        <div>
                            <label class="text-sm font-medium mb-2 block">新密码</label>
                            <input id="cfgNewPassword" type="password"
                                class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                                placeholder="输入新密码">
                        </div>
                        <button onclick="updateAdminPassword()"
                            class="inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 w-full">修改密码</button>
                    </div>
                </div>

                <!-- API 密钥配置 -->
                <div class="rounded-lg border border-border bg-background p-6">
                    <h3 class="text-lg font-semibold mb-4">API 密钥配置</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-sm font-medium mb-2 block">当前 API Key</label>
                            <input id="cfgCurrentAPIKey" type="text"
                                class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                                readonly disabled>
                            <p class="text-xs text-muted-foreground mt-1">当前使用的 API Key（只读）</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium mb-2 block">新 API Key</label>
                            <input id="cfgNewAPIKey" type="text"
                                class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                                placeholder="输入新的 API Key">
                            <p class="text-xs text-muted-foreground mt-1">用于客户端调用 API 的密钥</p>
                        </div>
                        <button onclick="updateAPIKey()"
                            class="inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 w-full">更新
                            API Key</button>
                    </div>
                </div>

                <!-- 代理配置 -->
                <div class="rounded-lg border border-border bg-background p-6">
                    <h3 class="text-lg font-semibold mb-4">代理配置</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="inline-flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="cfgProxyEnabled" class="h-4 w-4 rounded border-input">
                                <span class="text-sm font-medium">启用代理</span>
                            </label>
                        </div>
                        <div>
                            <label class="text-sm font-medium mb-2 block">代理地址</label>
                            <input id="cfgProxyUrl"
                                class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                                placeholder="http://127.0.0.1:7890 或 socks5://127.0.0.1:1080">
                            <p class="text-xs text-muted-foreground mt-1">支持 HTTP 和 SOCKS5 代理</p>
                        </div>
                        <button onclick="saveProxyConfig()"
                            class="inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 w-full">保存配置</button>
                    </div>
                </div>

                <!-- 错误处理配置 -->
                <div class="rounded-lg border border-border bg-background p-6">
                    <h3 class="text-lg font-semibold mb-4">错误处理配置</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-sm font-medium mb-2 block">错误封禁阈值</label>
                            <input id="cfgErrorBan" type="number"
                                class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                                placeholder="3">
                            <p class="text-xs text-muted-foreground mt-1">Token 连续错误达到此次数后自动禁用</p>
                        </div>
                        <button onclick="saveAdminConfig()"
                            class="inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 w-full">保存配置</button>
                    </div>
                </div>

                <!-- 缓存配置 -->
                <div class="rounded-lg border border-border bg-background p-6">
                    <h3 class="text-lg font-semibold mb-4">缓存配置</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="inline-flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="cfgCacheEnabled" class="h-4 w-4 rounded border-input"
                                    onchange="toggleCacheOptions()">
                                <span class="text-sm font-medium">启用缓存</span>
                            </label>
                            <p class="text-xs text-muted-foreground mt-1">关闭后，生成的图片和视频将直接输出原始链接，不会缓存到本地</p>
                        </div>

                        <!-- 缓存配置选项 -->
                        <div id="cacheOptions" style="display: none;" class="space-y-4 pt-4 border-t border-border">
                            <div>
                                <label class="text-sm font-medium mb-2 block">缓存超时时间（秒）</label>
                                <input id="cfgCacheTimeout" type="number"
                                    class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                                    placeholder="7200" min="60" max="86400">
                                <p class="text-xs text-muted-foreground mt-1">文件缓存超时时间，范围：60-86400 秒（1分钟-24小时）</p>
                            </div>
                            <div>
                                <label class="text-sm font-medium mb-2 block">缓存文件访问域名</label>
                                <input id="cfgCacheBaseUrl" type="text"
                                    class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                                    placeholder="https://yourdomain.com">
                                <p class="text-xs text-muted-foreground mt-1">留空则使用服务器地址，例如：https://yourdomain.com</p>
                            </div>
                            <div id="cacheEffectiveUrl" class="rounded-md bg-muted p-3 hidden">
                                <p class="text-xs text-muted-foreground">
                                    <strong>🌐 当前生效的访问地址：</strong><code id="cacheEffectiveUrlValue"
                                        class="bg-background px-1 py-0.5 rounded"></code>
                                </p>
                            </div>
                        </div>

                        <button onclick="saveCacheConfig()"
                            class="inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 w-full">保存配置</button>
                    </div>
                </div>

                <!-- 生成超时配置 -->
                <div class="rounded-lg border border-border bg-background p-6">
                    <h3 class="text-lg font-semibold mb-4">生成超时配置</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-sm font-medium mb-2 block">图片生成超时时间（秒）</label>
                            <input id="cfgImageTimeout" type="number"
                                class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                                placeholder="300" min="60" max="3600">
                            <p class="text-xs text-muted-foreground mt-1">图片生成超时时间，范围：60-3600 秒（1分钟-1小时），超时后自动释放Token锁
                            </p>
                        </div>
                        <div>
                            <label class="text-sm font-medium mb-2 block">视频生成超时时间（秒）</label>
                            <input id="cfgVideoTimeout" type="number"
                                class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                                placeholder="1500" min="60" max="7200">
                            <p class="text-xs text-muted-foreground mt-1">视频生成超时时间，范围：60-7200 秒（1分钟-2小时），超时后返回上游API超时错误
                            </p>
                        </div>
                        <button onclick="saveGenerationTimeout()"
                            class="inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 w-full">保存配置</button>
                    </div>
                </div>

                <!-- 无水印模式配置 -->
                <div class="rounded-lg border border-border bg-background p-6">
                    <h3 class="text-lg font-semibold mb-4">无水印模式配置</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="inline-flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="cfgWatermarkFreeEnabled" class="h-4 w-4 rounded border-input"
                                    onchange="toggleWatermarkFreeOptions()">
                                <span class="text-sm font-medium">开启无水印模式</span>
                            </label>
                            <p class="text-xs text-muted-foreground mt-2">
                                开启后生成的视频将会被发布到sora平台并且提取返回无水印的视频，在缓存到本地后会自动删除发布的视频</p>
                        </div>

                        <!-- 解析方式选择 -->
                        <div id="watermarkFreeOptions" style="display: none;"
                            class="space-y-4 pt-4 border-t border-border">
                            <div>
                                <label class="text-sm font-medium">解析方式</label>
                                <select id="cfgParseMethod"
                                    class="w-full mt-2 px-3 py-2 border border-input rounded-md bg-background text-foreground"
                                    onchange="toggleCustomParseOptions()">
                                    <option value="third_party">第三方解析</option>
                                    <option value="custom">自定义解析接口</option>
                                </select>
                            </div>

                            <!-- 自定义解析配置 -->
                            <div id="customParseOptions" style="display: none;" class="space-y-4">
                                <div>
                                    <label class="text-sm font-medium">解析服务器地址</label>
                                    <input type="text" id="cfgCustomParseUrl"
                                        placeholder="请输入解析服务器地址 (例如: http://example.com)"
                                        class="w-full mt-2 px-3 py-2 border border-input rounded-md bg-background text-foreground">
                                    <p class="text-xs text-muted-foreground mt-1"><a
                                            href="https://github.com/tibbar213/sora-downloader" target="_blank"
                                            class="text-blue-600 hover:text-blue-800 underline">部署自定义解析服务器</a></p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium">访问密钥</label>
                                    <input type="password" id="cfgCustomParseToken" placeholder="请输入访问密钥"
                                        class="w-full mt-2 px-3 py-2 border border-input rounded-md bg-background text-foreground">
                                </div>
                            </div>
                        </div>

                        <button onclick="saveWatermarkFreeConfig()"
                            class="inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 w-full">保存配置</button>
                    </div>
                </div>

                <!-- 调试配置 -->
                <div class="rounded-lg border border-border bg-background p-6">
                    <h3 class="text-lg font-semibold mb-4">调试配置</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="inline-flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="cfgDebugEnabled" class="h-4 w-4 rounded border-input"
                                    onchange="toggleDebugMode()">
                                <span class="text-sm font-medium">启用调试模式</span>
                            </label>
                            <p class="text-xs text-muted-foreground mt-2">开启后，详细的上游API请求和响应日志将写入 <code
                                    class="bg-muted px-1 py-0.5 rounded">logs.txt</code> 文件，重启生效</p>
                        </div>
                        <div
                            class="rounded-md bg-yellow-50 dark:bg-yellow-900/20 p-3 border border-yellow-200 dark:border-yellow-800">
                            <p class="text-xs text-yellow-800 dark:text-yellow-200">
                                ⚠️ <strong>注意：</strong>调试模式会产生非常非常大量的日志，仅限Debug时候开启，否则磁盘boom
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 请求日志面板 -->
        <div id="panelLogs" class="hidden">
            <div class="rounded-lg border border-border bg-background">
                <div class="flex items-center justify-between gap-4 p-4 border-b border-border">
                    <h3 class="text-lg font-semibold">请求日志</h3>
                    <button onclick="refreshLogs()"
                        class="inline-flex items-center justify-center rounded-md transition-colors hover:bg-accent h-8 w-8"
                        title="刷新">
                        <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10" />
                            <polyline points="1 20 1 14 7 14" />
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
                        </svg>
                    </button>
                </div>
                <div class="relative w-full overflow-auto max-h-[600px]">
                    <table class="w-full text-sm">
                        <thead class="sticky top-0 bg-background">
                            <tr class="border-b border-border">
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">操作</th>
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">Token邮箱
                                </th>
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">状态码</th>
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">耗时(秒)
                                </th>
                                <th class="h-10 px-3 text-left align-middle font-medium text-muted-foreground">时间</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody" class="divide-y divide-border">
                            <!-- 动态填充 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 视频同步面板 -->
        <div id="panelVideos" class="hidden">
            <div class="rounded-lg border border-border bg-background p-6">
                <h3 class="text-lg font-semibold mb-4">视频同步 & 转存</h3>
                <p class="text-sm text-muted-foreground mb-6">
                    从 Sora 账号同步最新生成的视频，自动执行无水印处理并上传到 Google Drive。
                    <br>默认使用“无水印模式”配置进行处理。
                </p>
                <div class="flex items-end gap-4 mb-6">
                    <div>
                        <label class="text-sm font-medium mb-2 block">同步数量</label>
                        <input id="syncLimit" type="number"
                            class="flex h-9 w-32 rounded-md border border-input bg-background px-3 py-2 text-sm"
                            value="1" min="1" max="10">
                        <p class="text-xs text-muted-foreground mt-1">每次同步检查的最新视频数</p>
                    </div>
                    <div>
                        <button id="btnSyncVideo" onclick="syncLatestVideo()"
                            class="inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-5 text-sm font-medium">
                            <span id="btnSyncText">开始同步</span>
                            <svg id="btnSyncSpinner" class="hidden animate-spin h-4 w-4 ml-2"
                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                    stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                </path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="rounded-lg border border-border bg-muted/30 p-4">
                    <h4 class="text-sm font-semibold mb-2">处理日志</h4>
                    <pre id="syncLog"
                        class="text-xs font-mono whitespace-pre-wrap text-muted-foreground bg-background p-3 rounded border border-border h-64 overflow-y-auto">等待操作...</pre>
                </div>
            </div>
        </div>

        <!-- 生成面板 -->
        <div id="panelGenerate" class="hidden" style="background: #ffffff;">
            <iframe id="generateFrame" src="/static/generate.html?v=20251214b" class="w-full"
                style="border: 0; background: #ffffff; display:block; width:100%;" loading="lazy"></iframe>
        </div>

        <!-- 角色卡面板 -->
        <div id="panelCharacters" class="hidden">
            <section class="cc-surface border border-border p-4 sm:p-5">
                <div class="relative flex flex-col gap-4">
                    <div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between">
                        <div>
                            <h3 class="text-lg font-semibold">角色卡</h3>
                            <p class="text-xs text-muted-foreground">支持搜索/排序/视图切换；点卡片可查看详情并重命名。</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <div id="characterCount" class="text-xs text-muted-foreground"></div>
                            <button id="characterRefreshBtn"
                                class="cc-btn cc-focus inline-flex items-center justify-center rounded-md transition-colors hover:bg-accent h-8 px-3 text-sm"
                                type="button">
                                刷新
                            </button>
                            <button id="characterSyncBtn"
                                class="cc-btn cc-focus inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-8 px-3 text-sm"
                                type="button" title="从所有活跃Token同步角色数据">
                                同步
                            </button>
                        </div>
                    </div>

                    <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                        <div class="flex flex-1 items-center gap-2">
                            <div class="relative flex-1"><input id="characterSearch"
                                    class="cc-focus flex h-9 w-full rounded-md border border-input bg-background/70 backdrop-blur px-9 py-2 text-sm"
                                    placeholder="搜索..."><button id="characterSearchClear"
                                    class="cc-btn cc-focus hidden absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 rounded-md hover:bg-accent text-slate-500"
                                    type="button" title="清空">
                                    <span class="text-lg leading-none" aria-hidden="true">×</span>
                                </button>
                            </div>
                            <select id="characterSort"
                                class="cc-focus flex h-9 rounded-md border border-input bg-background/70 backdrop-blur px-3 text-sm">
                                <option value="newest">最新创建</option>
                                <option value="oldest">最早创建</option>
                                <option value="name_asc">名称 A→Z</option>
                                <option value="name_desc">名称 Z→A</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-2"><button id="characterViewGrid"
                                class="cc-btn cc-focus inline-flex items-center justify-center rounded-md border border-input bg-background/70 backdrop-blur h-9 px-3 text-sm">网格</button><button
                                id="characterViewList"
                                class="cc-btn cc-focus inline-flex items-center justify-center rounded-md border border-input bg-background/70 backdrop-blur h-9 px-3 text-sm">列表</button>
                        </div>
                    </div>

                    <div id="characterBulkBar"
                        class="hidden rounded-xl border border-border bg-background/70 backdrop-blur px-3 py-2 flex items-center justify-between gap-3">
                        <div class="text-sm text-foreground">已选择 <span id="characterSelectedCount"
                                class="font-semibold">0</span> 个</div>
                        <div class="flex items-center gap-2"><button id="characterBulkCopy"
                                class="cc-btn cc-focus inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-8 px-3 text-sm">复制
                                @username</button><button id="characterBulkClear"
                                class="cc-btn cc-focus inline-flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent h-8 px-3 text-sm">取消选择</button>
                        </div>
                    </div>

                    <div id="characterEmpty">
                        <div class="rounded-2xl border border-border bg-background/70 backdrop-blur p-6 text-center">
                            <div class="text-sm font-semibold">暂无角色卡</div>
                            <div id="characterEmptySubtitle" class="mt-1 text-xs text-muted-foreground">
                                去“生成面板”上传参考视频创建一个角色卡，或稍后刷新。</div>
                            <div class="mt-4 flex items-center justify-center gap-2"><button id="characterGoGenerateBtn"
                                    class="cc-btn cc-focus inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 text-sm">去生成面板</button><button
                                    id="characterEmptyRefreshBtn"
                                    class="cc-btn cc-focus inline-flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent h-9 px-4 text-sm">刷新</button>
                            </div>
                        </div>
                    </div>

                    <div id="characterGrid" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
                </div>
            </section>
        </div>

        <!-- 角色卡详情弹窗 -->
        <div id="characterModal" class="hidden fixed inset-0 z-50" aria-hidden="true">
            <div id="characterModalOverlay" class="absolute inset-0 bg-black/40"></div>
            <div class="absolute left-1/2 top-1/2 w-full max-w-2xl px-4 -translate-x-1/2 -translate-y-1/2">
                <div class="cc-surface border border-border shadow-2xl">
                    <div class="relative p-4 border-b border-border flex items-start justify-between gap-3">
                        <div class="min-w-0">
                            <div class="flex items-center gap-2">
                                <h4 id="characterModalTitle" class="text-lg font-semibold truncate">角色</h4>
                                <button id="characterModalCopyUsernameChip"
                                    class="cc-btn cc-focus inline-flex items-center rounded-full border border-border bg-background/70 backdrop-blur px-2 py-0.5 text-xs font-medium"
                                    type="button" title="点击复制 @username">
                                    @-
                                </button>
                            </div>
                            <div id="characterModalSub" class="mt-1 text-xs text-muted-foreground">-</div>
                        </div>
                        <button id="characterModalClose"
                            class="cc-btn cc-focus inline-flex items-center justify-center rounded-md border border-input bg-background/70 backdrop-blur h-8 w-8 hover:bg-accent"
                            type="button" aria-label="关闭">
                            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18" />
                                <line x1="6" y1="6" x2="18" y2="18" />
                            </svg>
                        </button>
                    </div>
                    <div class="relative p-4 flex flex-col gap-4 sm:flex-row">
                        <div class="shrink-0 space-y-2 sm:w-40">
                            <img id="characterModalAvatar"
                                class="h-32 w-32 sm:h-36 sm:w-36 rounded-2xl border border-border object-cover bg-white"
                                alt="角色头像">
                            <div class="flex items-center gap-2">
                                <button id="characterModalOpenAvatar"
                                    class="cc-btn cc-focus inline-flex items-center justify-center rounded-md border border-input bg-background/70 backdrop-blur h-8 px-3 text-sm hover:bg-accent"
                                    type="button">打开头像</button>
                                <button id="characterModalCopyAvatar"
                                    class="cc-btn cc-focus inline-flex items-center justify-center rounded-md border border-input bg-background/70 backdrop-blur h-8 px-3 text-sm hover:bg-accent"
                                    type="button">复制链接</button>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0 space-y-3">
                            <div class="space-y-1">
                                <label class="text-xs text-muted-foreground">显示名（可改）</label>
                                <div class="flex items-center gap-2">
                                    <input id="characterModalDisplayName"
                                        class="cc-focus flex h-9 w-full rounded-md border border-input bg-background/70 backdrop-blur px-3 py-2 text-sm" />
                                    <button id="characterModalSaveName"
                                        class="cc-btn cc-focus inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 text-sm disabled:opacity-50 disabled:cursor-not-allowed"
                                        type="button">
                                        保存
                                    </button>
                                </div>
                            </div>

                            <div class="grid gap-3 sm:grid-cols-2">
                                <div class="rounded-xl border border-border bg-background/70 backdrop-blur p-3">
                                    <div class="text-xs text-muted-foreground">Cameo ID</div>
                                    <div class="mt-1 flex items-center justify-between gap-2">
                                        <code id="characterModalCameoId"
                                            class="text-xs font-mono text-foreground break-all">-</code>
                                        <button id="characterModalCopyCameoId"
                                            class="cc-btn cc-focus inline-flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent h-8 px-3 text-sm"
                                            type="button">复制</button>
                                    </div>
                                </div>
                                <div class="rounded-xl border border-border bg-background/70 backdrop-blur p-3">
                                    <div class="text-xs text-muted-foreground">Character ID</div>
                                    <div class="mt-1 flex items-center justify-between gap-2">
                                        <code id="characterModalCharacterId"
                                            class="text-xs font-mono text-foreground break-all">-</code>
                                        <button id="characterModalCopyCharacterId"
                                            class="cc-btn cc-focus inline-flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent h-8 px-3 text-sm"
                                            type="button">复制</button>
                                    </div>
                                </div>
                            </div>

                            <div class="rounded-xl border border-border bg-background/70 backdrop-blur p-3">
                                <div class="text-xs text-muted-foreground">描述</div>
                                <div id="characterModalDesc"
                                    class="mt-1 text-sm text-foreground whitespace-pre-wrap break-words"></div>
                            </div>

                            <div
                                class="pt-2 border-t border-border flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                                <div class="flex items-center gap-2">
                                    <button id="characterModalOpenSource"
                                        class="cc-btn cc-focus inline-flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent h-8 px-3 text-sm disabled:opacity-50 disabled:cursor-not-allowed"
                                        type="button">打开来源视频</button>
                                    <button id="characterModalCopySource"
                                        class="cc-btn cc-focus inline-flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent h-8 px-3 text-sm disabled:opacity-50 disabled:cursor-not-allowed"
                                        type="button">复制来源</button>
                                </div>
                                <button id="characterModalDelete"
                                    class="cc-btn cc-focus inline-flex items-center justify-center rounded-md bg-destructive text-destructive-foreground hover:bg-destructive/90 h-8 px-3 text-sm"
                                    type="button">
                                    删除角色卡
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-12 pt-6 border-t border-border text-center text-xs text-muted-foreground">
            <p>© 2025 <a href="https://github.com/TheSmallHanCat/sora2api" target="_blank"
                    class="no-underline hover:underline">Sora2API</a>. All rights reserved.</p>
        </footer>
    </main>

    <!-- Modals (Add, Edit, Import, Sora2) - FULLY RESTORED -->

    <!-- 添加 Token 模态框 -->
    <div id="addModal"
        class="hidden fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-background rounded-lg border border-border w-full max-w-2xl shadow-xl my-auto">
            <div class="flex items-center justify-between p-5 border-b border-border sticky top-0 bg-background">
                <div class="flex items-center gap-2">
                    <h3 class="text-lg font-semibold">添加 Token</h3>
                    <button onclick="closeAddModal(); openImportModal();"
                        class="text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-100 px-2 py-1 rounded hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors"
                        title="先从网络同步数据">
                        从网络同步
                    </button>
                </div>
                <button onclick="closeAddModal()" class="text-muted-foreground hover:text-foreground">
                    <svg class="h-3.5 w-3.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="p-5 space-y-4 max-h-[calc(100vh-200px)] overflow-y-auto">
                <!-- Access Token -->
                <div class="space-y-2">
                    <label class="text-sm font-medium">Access Token (AT) <span class="text-red-500">*</span></label>
                    <textarea id="addTokenAT" rows="3"
                        class="flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm font-mono resize-none"
                        placeholder="请输入 Access Token 或使用下方 ST/RT 转换"></textarea>
                    <p class="text-xs text-muted-foreground">格式: eyJh... (JWT格式)</p>
                </div>

                <!-- Session Token -->
                <div class="space-y-2">
                    <label class="text-sm font-medium">Session Token (ST) <span class="text-muted-foreground text-xs">-
                            可选</span></label>
                    <div class="flex gap-2">
                        <textarea id="addTokenST" rows="2"
                            class="flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm font-mono resize-none"
                            placeholder="输入 Session Token 后点击转换"></textarea>
                        <button onclick="convertST2AT()"
                            class="inline-flex items-center justify-center rounded-md bg-blue-600 text-white hover:bg-blue-700 px-4 whitespace-nowrap h-auto">
                            ST→AT
                        </button>
                    </div>
                    <p class="text-xs text-muted-foreground">从浏览器 Cookie 中获取 __Secure-next-auth.session-token</p>
                </div>

                <!-- Refresh Token -->
                <div class="space-y-2">
                    <label class="text-sm font-medium">Refresh Token (RT) <span class="text-muted-foreground text-xs">-
                            可选</span></label>
                    <div class="flex gap-2">
                        <textarea id="addTokenRT" rows="2"
                            class="flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm font-mono resize-none"
                            placeholder="输入 Refresh Token 后点击转换"></textarea>
                        <button onclick="convertRT2AT()"
                            class="inline-flex items-center justify-center rounded-md bg-green-600 text-white hover:bg-green-700 px-4 whitespace-nowrap h-auto">
                            RT→AT
                        </button>
                    </div>
                    <p class="text-xs text-muted-foreground">从移动端或其他客户端获取</p>
                    <p id="addRTRefreshHint" class="text-xs text-green-600 font-medium hidden">✓ RT已被刷新，已填入更新后的RT</p>
                </div>

                <!-- Client ID -->
                <div class="space-y-2">
                    <label class="text-sm font-medium">Client ID <span class="text-muted-foreground text-xs">-
                            可选</span></label>
                    <input id="addTokenClientId"
                        class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm font-mono"
                        placeholder="留空使用默认值">
                    <p class="text-xs text-muted-foreground">用于 RT 刷新，留空使用默认 Client ID</p>
                </div>

                <!-- Remark -->
                <div class="space-y-2">
                    <label class="text-sm font-medium">备注 <span class="text-muted-foreground text-xs">-
                            可选</span></label>
                    <input id="addTokenRemark"
                        class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                        placeholder="添加备注信息">
                </div>

                <!-- 功能开关 -->
                <div class="space-y-3 pt-2 border-t border-border">
                    <label class="text-sm font-medium">功能开关</label>
                    <div class="space-y-2">
                        <div class="flex items-center gap-3">
                            <label class="inline-flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="addTokenImageEnabled" checked
                                    class="h-4 w-4 rounded border-input">
                                <span class="text-sm font-medium">启用图片生成</span>
                            </label>
                            <input type="number" id="addTokenImageConcurrency" value="-1"
                                class="flex h-8 w-20 rounded-md border border-input bg-background px-2 py-1 text-sm"
                                placeholder="并发数" title="并发数量限制：设置同时处理的最大请求数。-1表示不限制">
                        </div>
                    </div>
                    <div class="space-y-2">
                        <div class="flex items-center gap-3">
                            <label class="inline-flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="addTokenVideoEnabled" checked
                                    class="h-4 w-4 rounded border-input">
                                <span class="text-sm font-medium">启用视频生成</span>
                            </label>
                            <input type="number" id="addTokenVideoConcurrency" value="-1"
                                class="flex h-8 w-20 rounded-md border border-input bg-background px-2 py-1 text-sm"
                                placeholder="并发数" title="并发数量限制：设置同时处理的最大请求数。-1表示不限制">
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex items-center justify-end gap-3 p-5 border-t border-border sticky bottom-0 bg-background">
                <button onclick="closeAddModal()"
                    class="inline-flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent h-9 px-5">取消</button>
                <button id="addTokenBtn" onclick="submitAddToken()"
                    class="inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-5">
                    <span id="addTokenBtnText">添加</span>
                    <svg id="addTokenBtnSpinner" class="hidden animate-spin h-4 w-4 ml-2"
                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- 编辑 Token 模态框 -->
    <div id="editModal"
        class="hidden fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-background rounded-lg border border-border w-full max-w-2xl shadow-xl my-auto">
            <div class="flex items-center justify-between p-5 border-b border-border sticky top-0 bg-background">
                <h3 class="text-lg font-semibold">编辑 Token</h3>
                <button onclick="closeEditModal()" class="text-muted-foreground hover:text-foreground">
                    <svg class="h-3.5 w-3.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="p-5 space-y-4 max-h-[calc(100vh-200px)] overflow-y-auto">
                <input type="hidden" id="editTokenId">

                <!-- Access Token -->
                <div class="space-y-2">
                    <label class="text-sm font-medium">Access Token (AT) <span class="text-red-500">*</span></label>
                    <textarea id="editTokenAT" rows="3"
                        class="flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm font-mono resize-none"
                        placeholder="请输入 Access Token 或使用下方 ST/RT 转换"></textarea>
                    <p class="text-xs text-muted-foreground">格式: eyJh... (JWT格式)</p>
                </div>

                <!-- Session Token -->
                <div class="space-y-2">
                    <label class="text-sm font-medium">Session Token (ST) <span class="text-muted-foreground text-xs">-
                            可选</span></label>
                    <div class="flex gap-2">
                        <textarea id="editTokenST" rows="2"
                            class="flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm font-mono resize-none"
                            placeholder="输入 Session Token 后点击转换"></textarea>
                        <button onclick="convertEditST2AT()"
                            class="inline-flex items-center justify-center rounded-md bg-blue-600 text-white hover:bg-blue-700 px-4 whitespace-nowrap h-auto">
                            ST→AT
                        </button>
                    </div>
                    <p class="text-xs text-muted-foreground">从浏览器 Cookie 中获取 __Secure-next-auth.session-token</p>
                </div>

                <!-- Refresh Token -->
                <div class="space-y-2">
                    <label class="text-sm font-medium">Refresh Token (RT) <span class="text-muted-foreground text-xs">-
                            可选</span></label>
                    <div class="flex gap-2">
                        <textarea id="editTokenRT" rows="2"
                            class="flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm font-mono resize-none"
                            placeholder="输入 Refresh Token 后点击转换"></textarea>
                        <button onclick="convertEditRT2AT()"
                            class="inline-flex items-center justify-center rounded-md bg-green-600 text-white hover:bg-green-700 px-4 whitespace-nowrap h-auto">
                            RT→AT
                        </button>
                    </div>
                    <p class="text-xs text-muted-foreground">从移动端或其他客户端获取</p>
                    <p id="editRTRefreshHint" class="text-xs text-green-600 font-medium hidden">✓ RT已被刷新，已填入更新后的RT</p>
                </div>

                <!-- Client ID -->
                <div class="space-y-2">
                    <label class="text-sm font-medium">Client ID <span class="text-muted-foreground text-xs">-
                            可选</span></label>
                    <input id="editTokenClientId"
                        class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm font-mono"
                        placeholder="留空使用默认值">
                    <p class="text-xs text-muted-foreground">用于 RT 刷新，留空使用默认 Client ID</p>
                </div>

                <!-- Remark -->
                <div class="space-y-2">
                    <label class="text-sm font-medium">备注 <span class="text-muted-foreground text-xs">-
                            可选</span></label>
                    <input id="editTokenRemark"
                        class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                        placeholder="添加备注信息">
                </div>

                <!-- 功能开关 -->
                <div class="space-y-3 pt-2 border-t border-border">
                    <label class="text-sm font-medium">功能开关</label>
                    <div class="space-y-2">
                        <div class="flex items-center gap-3">
                            <label class="inline-flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="editTokenImageEnabled" class="h-4 w-4 rounded border-input">
                                <span class="text-sm font-medium">启用图片生成</span>
                            </label>
                            <input type="number" id="editTokenImageConcurrency"
                                class="flex h-8 w-20 rounded-md border border-input bg-background px-2 py-1 text-sm"
                                placeholder="并发数" title="并发数量限制：设置同时处理的最大请求数。-1表示不限制">
                        </div>
                    </div>
                    <div class="space-y-2">
                        <div class="flex items-center gap-3">
                            <label class="inline-flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="editTokenVideoEnabled" class="h-4 w-4 rounded border-input">
                                <span class="text-sm font-medium">启用视频生成</span>
                            </label>
                            <input type="number" id="editTokenVideoConcurrency"
                                class="flex h-8 w-20 rounded-md border border-input bg-background px-2 py-1 text-sm"
                                placeholder="并发数" title="并发数量限制：设置同时处理的最大请求数。-1表示不限制">
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex items-center justify-end gap-3 p-5 border-t border-border sticky bottom-0 bg-background">
                <button onclick="closeEditModal()"
                    class="inline-flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent h-9 px-5">取消</button>
                <button id="editTokenBtn" onclick="submitEditToken()"
                    class="inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-5">
                    <span id="editTokenBtnText">保存</span>
                    <svg id="editTokenBtnSpinner" class="hidden animate-spin h-4 w-4 ml-2"
                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Sora2 激活模态框 -->
    <div id="sora2Modal" class="hidden fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4">
        <div class="bg-background rounded-lg border border-border w-full max-w-md shadow-xl">
            <div class="flex items-center justify-between p-5 border-b border-border">
                <h3 class="text-lg font-semibold">激活 Sora2</h3>
                <button onclick="closeSora2Modal()" class="text-muted-foreground hover:text-foreground">
                    <svg class="h-3.5 w-3.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="p-5 space-y-4">
                <input type="hidden" id="sora2TokenId">
                <div>
                    <label class="text-sm font-medium mb-2 block">Sora2 邀请码</label>
                    <input id="sora2InviteCode"
                        class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                        placeholder="输入6位邀请码，例如：0ZSKEG">
                    <p class="text-xs text-muted-foreground mt-1">输入Sora2邀请码以激活该Token的Sora2功能</p>
                </div>
            </div>
            <div class="flex items-center justify-end gap-3 p-5 border-t border-border">
                <button onclick="closeSora2Modal()"
                    class="inline-flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent h-9 px-5">取消</button>
                <button id="sora2ActivateBtn" onclick="submitSora2Activate()"
                    class="inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-5">
                    <span id="sora2ActivateBtnText">激活</span>
                    <svg id="sora2ActivateBtnSpinner" class="hidden animate-spin h-4 w-4 ml-2"
                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Token 导入模态框 -->
    <div id="importModal" class="hidden fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4">
        <div class="bg-background rounded-lg border border-border w-full max-w-md shadow-xl">
            <div class="flex items-center justify-between p-5 border-b border-border">
                <h3 class="text-lg font-semibold">导入 Token</h3>
                <button onclick="closeImportModal()" class="text-muted-foreground hover:text-foreground">
                    <svg class="h-3.5 w-3.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="p-5 space-y-4">
                <div>
                    <label class="text-sm font-medium mb-2 block">方式一：从文件导入</label>
                    <input type="file" id="importFile" accept=".json"
                        class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm">
                    <p class="text-xs text-muted-foreground mt-1">选择导出的 Token JSON 文件进行导入</p>
                </div>

                <div class="relative py-2">
                    <div class="absolute inset-0 flex items-center"><span class="w-full border-t border-border"></span>
                    </div>
                    <div class="relative flex justify-center text-xs uppercase"><span
                            class="bg-background px-2 text-muted-foreground">OR</span></div>
                </div>

                <div>
                    <label class="text-sm font-medium mb-2 block">方式二：从 JSONBin 导入</label>
                    <div class="space-y-3">
                        <input type="text" id="importJsonBinId"
                            class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                            placeholder="Bin ID 或完整 URL (https://api.jsonbin.io/v3/b/...)">
                        <input type="password" id="importJsonBinKey"
                            class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
                            placeholder="Master Key / Access Key (私有Bin必填)">
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="importJsonBinMerge" class="h-4 w-4 rounded border-input" checked>
                            <label for="importJsonBinMerge"
                                class="text-xs text-muted-foreground">合并模式（保留本地已有，仅更新/新增）</label>
                        </div>
                    </div>
                </div>

                <div class="rounded-md bg-blue-50 dark:bg-blue-900/20 p-3 border border-blue-200 dark:border-blue-800">
                    <p class="text-xs text-blue-800 dark:text-blue-200">
                        <strong>说明：</strong>导入时将根据邮箱匹配。如果邮箱存在则会更新，不存在则新增。
                    </p>
                </div>
            </div>
            <div class="flex items-center justify-end gap-3 p-5 border-t border-border">
                <button onclick="closeImportModal()"
                    class="inline-flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent h-9 px-5">取消</button>
                <button id="importBtn" onclick="submitImportTokens()"
                    class="inline-flex items-center justify-center rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-5">
                    <span id="importBtnText">导入</span>
                    <svg id="importBtnSpinner" class="hidden animate-spin h-4 w-4 ml-2"
                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script src="/static/js/manage.js?v=20251214c"></script>
    <script src="/static/js/manage_sync.js?v=20251227"></script>
</body>

</html>